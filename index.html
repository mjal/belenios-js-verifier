<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Election verifier</title>
    <link rel="stylesheet" type="text/css" href="/vendor/franken-ui-0.0.12.min.css" />
  </head>
  <body>
    <div class="uk-container uk-container-xsmall uk-padding">
      <h1 class="uk-h2 uk-text-center">Belenios Election Verifier</h1>

      <div id="import" class="uk-card uk-card-body uk-width-medium uk-margin uk-margin-auto">
        <h3 class="uk-card-title">Import your .bel file</h3>

        <div class="js-upload" uk-form-custom>
          <input type="file" id="file" placeholder="Import your .bel file" />
          <button class="uk-button uk-button-default uk-margin-top" type="button" tabindex="-1">
            Import
          </button>
        </div>
      </div>

      <div id="spinner" class="uk-text-center uk-margin uk-hidden">
        <span uk-spinner="ratio: 4.5" class="uk-margin-auto"></span>
      </div>

      <div id="alerts"></div>

      <div id="actions" class="uk-hidden uk-margin">
        <button id="find-your-ballot" class="uk-button uk-button-default" type="button">Find your ballot</button>
        <button uk-toggle="target: #generate-ballot-modal" class="uk-button uk-button-default" type="button">Generate a ballot</button>
      </div>

      <ul uk-tab>
        <li><a href="#">Verifications</a></li>
        <li><a href="#">Election infos</a></li>
        <li><a href="#">Ballots</a></li>
      </ul>

      <!-- Tab Contents -->
      <ul class="uk-switcher uk-margin">
        <li>
          <h3 id="top"></h3>
          <div id="database"></div>
          <div id="setup"></div>
          <div id="ballots"></div>
          <div id="encryptedTally"></div>
          <div id="partialDecryptions"></div>
          <div id="result"></div>
        </li>
        <li>
          <div id="election-info">
          </div>
          <div id="election-results">
          </div>
        </li>
        <li>
          <input id="ballot-search" placeholder="Search a ballot by smart tracker id" class="uk-input uk-margin" type="text" />
          <ul id="ballot-list" class="uk-list uk-list-disc">
          </ul>
        </li>
      </ul>
    </div>

    <div class="uk-modal p-6" id="generate-ballot-modal" uk-modal>
      <div class="uk-modal-body uk-modal-dialog">
        <h2 class="uk-modal-title">Generate a ballot</h2>
        <form class="uk-form-stacked uk-margin">
          <div class="uk-margin">
            <label class="uk-form-label" for="generate-ballot-private-key">
              Code de vote
            </label>
            <div class="uk-form-controls">
              <input
              class="uk-input generate-ballot-input"
              id="generate-ballot-private-key"
              type="text"
              placeholder="Paste your code"
              />
            </div>
          </div>
          <div id="generate-ballot-form">
          </div>

          <div class="uk-margin">
            <label class="uk-form-label" for="generate-ballot-ballot">Your ballot</label>
            <textarea
              id="generate-ballot-ballot"
              class="uk-textarea"
              rows="5"
              placeholder="Textarea"
              aria-label="Textarea"
              style="white-space: pre-wrap"
              readonly
              ></textarea>
          </div>
        </form>
        <button class="uk-modal-close uk-button uk-button-default" type="button">Close</button>
      </div>
    </div>

    <script type="text/template" id="election-info-template">
      <div class="uk-card uk-card-default uk-card-body uk-margin">
        <h3 class="uk-card-title"><%- name %></h3>
        <p><%- description %></p>
        <p>Election UUID: <%- uuid %></p>
        <p>Election fingerprint: <%- fingerprint %></p>
        <p>Number of ballots: <%- countBallots %></p>
      </div>
    </script>

    <script type="text/template" id="election-results-template">
      <div class="uk-card uk-card-default uk-card-body uk-margin">
        <h3 class="uk-card-title">Results</h3>
        <ul>
          <% for (let i = 0; i < questions.length; i++) { %>
            <% if (questions[i].type !== undefined) { continue } %>
            <table class="uk-table uk-table-divider">
              <h4><%- questions[i].question %></h4>
              <thead>
                <tr>
                  <th>Answer</th>
                  <th>Result</th>
                </tr>
              </thead>
              <tbody>
                <% for (let j = 0; j < questions[i].answers.length; j++) { %>
                  <tr>
                    <td><%- questions[i].answers[j] %></td>
                    <td><%- result[i][j] %></td>
                  </tr>
                <% } %>
              </tbody>
            </table>
          <% } %>
        </ul>
      </div>
    </script>

    <script type="text/template" id="election-ballot-template">
      <div class="uk-card uk-card-default uk-card-body uk-margin">
        <h3 class="uk-card-title">Ballot tracker: <%- ballot.tracker %></h3>
        <div><span>Status: </span>
          <% if (!state.encryptedTally) { %>
            <span class="uk-badge uk-badge-warning">Pending</span>
          <% } else if (ballot.accepted) { %>
            <span class="uk-badge uk-badge-success">Accepted</span>
          <% } else { %>
            <span class="uk-badge uk-badge-danger">Rejected</span>
          <% } %>
        </div>
      </div>
    </script>

    <script type="text/template" id="generate-ballot-form-template">
      <form onsubmit="generateBallot(); return false;">
        <div class="uk-margin">
          <% for (let i = 0; i < questions.length; i++) { %>
            <div class="uk-margin">
              <label class="uk-form-label" for="q-<%- i %>">
                <%- questions[i].question %>
              </label>
              <div class="uk-form-controls">
                <select class="uk-select generate-ballot-input" id="q-<%- i %>">
                  <option value="">Select an answer</option>
                  <% for (let j = 0; j < questions[i].answers.length; j++) { %>
                    <option value="<%- j %>"><%- questions[i].answers[j] %></option>
                  <% } %>
                </select>
              </div>
            </div>
          <% } %>
          <input type="submit" class="uk-button uk-button-default" value="Generate ballot" />
        </div>
      </form>
    </script>

    <script type="module" src="src/web.js"></script>
    <script type="module" src="/vendor/uikit.min.js.js"></script>
    <script type="module" src="/vendor/uikit-icons.min.js.js"></script>
  </body>
</html>
